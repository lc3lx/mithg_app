# ูุธุงู ุงูุฅุฏุงุฑุฉ ูุงููุฑุงูุจุฉ - Moderation System

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ููุฅุฏุงุฑุฉ ูุงููุฑุงูุจุฉ ูุชุถูู:

- ูุฑุงูุจุฉ ุงููุญุงุฏุซุงุช ููุฅุฏุงุฑุฉ
- ูุธุงู ููุงุชุฑ ูููููุงุช ุงูููููุนุฉ
- ูุธุงู ุชุญุฐูุฑุงุช ูุฅูุฐุงุฑุงุช ูููุณุชุฎุฏููู
- ุญุธุฑ ุชููุงุฆู ููุฏูู ูููุณุชุฎุฏููู

---

## ๐ ุตูุงุญูุงุช ุงูุฅุฏุงุฑุฉ ุงูุฌุฏูุฏุฉ

### ูููุฐุฌ ุงูุฅุฏุงุฑุฉ ุงููุญุฏุซ

```javascript
permissions: {
  monitorChats: Boolean,      // ูุฑุงูุจุฉ ุงููุญุงุฏุซุงุช
  manageBannedWords: Boolean, // ุฅุฏุงุฑุฉ ุงููููุงุช ุงูููููุนุฉ
  moderateContent: Boolean,   // ุฅุฏุงุฑุฉ ุงููุญุชูู ูุงููุณุชุฎุฏููู
}
```

### ุงูุตูุงุญูุงุช ุงูุงูุชุฑุงุถูุฉ ุญุณุจ ุงูููุน:

- **Super Admin**: ุฌููุน ุงูุตูุงุญูุงุช
- **Male/Female Admin**: monitorChats + moderateContent (ุจุฏูู manageBannedWords)

---

## ๐ซ ูุธุงู ุงููููุงุช ุงูููููุนุฉ

### ูููุฐุฌ BannedWords

```javascript
{
  word: String,           // ุงููููุฉ ุงูููููุนุฉ
  variations: [String],   // ุงููุชุบูุฑุงุช ูุงูุฅููุงุกุงุช ุงูุจุฏููุฉ
  category: String,       // ุงูุชุตููู (profanity, hate_speech, etc.)
  severity: String,       // ุงูุดุฏุฉ (low, medium, high, critical)
  warningMessage: String, // ุฑุณุงูุฉ ุงูุชุญุฐูุฑ
  autoBlockThreshold: Number, // ุนุฏุฏ ุงูุชุญุฐูุฑุงุช ูุจู ุงูุญุธุฑ ุงูุชููุงุฆู
  blockDurationHours: Number, // ูุฏุฉ ุงูุญุธุฑ ุจุงูุณุงุนุงุช
  isActive: Boolean,      // ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุงููููุฉ
}
```

### ุฅุฏุงุฑุฉ ุงููููุงุช ุงูููููุนุฉ

#### ุฅุถุงูุฉ ูููุฉ ูุญุธูุฑุฉ

```http
POST /api/v1/banned-words
Content-Type: application/json

{
  "word": "ูููุฉ_ุณูุฆุฉ",
  "variations": ["ูุชุบูุฑ1", "ูุชุบูุฑ2"],
  "category": "profanity",
  "severity": "medium",
  "warningMessage": "ุชู ุงูุชุดุงู ูุญุชูู ุบูุฑ ููุงุณุจ",
  "autoBlockThreshold": 3,
  "blockDurationHours": 24
}
```

#### ุฅุถุงูุฉ ูููุงุช ุจุงูุฌููุฉ

```http
POST /api/v1/banned-words/bulk
Content-Type: application/json

{
  "words": [
    { "word": "ูููุฉ1", "category": "profanity" },
    { "word": "ูููุฉ2", "category": "hate_speech" }
  ],
  "category": "profanity",  // ุงูุชุฑุงุถู ูููููุงุช ุจุฏูู ุชุตููู
  "severity": "medium"       // ุงูุชุฑุงุถู ูููููุงุช ุจุฏูู ุดุฏุฉ
}
```

#### ุนุฑุถ ุงููููุงุช ุงููุญุธูุฑุฉ

```http
GET /api/v1/banned-words
GET /api/v1/banned-words/stats/summary
GET /api/v1/banned-words/export/all
```

#### ุชุญุฏูุซ/ุญุฐู ุงููููุงุช

```http
PUT /api/v1/banned-words/:id
DELETE /api/v1/banned-words/:id
PUT /api/v1/banned-words/:id/toggle  // ุชูุนูู/ุฅูุบุงุก ุชูุนูู
```

---

## โ๏ธ ูุธุงู ุงูุชุญุฐูุฑุงุช ูุงูุฅูุฐุงุฑุงุช

### ูููุฐุฌ UserWarnings

```javascript
{
  user: ObjectId,         // ุงููุณุชุฎุฏู ุงููุญุฐุฑ
  warningType: String,    // ููุน ุงูุชุญุฐูุฑ
  severity: String,       // ุดุฏุฉ ุงูุชุญุฐูุฑ
  bannedWord: ObjectId,   // ุงููููุฉ ุงููุฎุงููุฉ (ุงุฎุชูุงุฑู)
  violatedMessage: ObjectId, // ุงูุฑุณุงูุฉ ุงููุฎุงููุฉ
  chat: ObjectId,         // ุงููุญุงุฏุซุฉ ุงูุชู ููุนุช ูููุง ุงููุฎุงููุฉ
  warningMessage: String, // ุฑุณุงูุฉ ุงูุชุญุฐูุฑ
  issuedBy: ObjectId,     // ุงูุฅุฏุงุฑู ุงูุฐู ุฃุตุฏุฑ ุงูุชุญุฐูุฑ
  isAutomatic: Boolean,   // ุชุญุฐูุฑ ุชููุงุฆู ุฃู ูุฏูู
  status: String,         // ุญุงูุฉ ุงูุชุญุฐูุฑ (active, appealed, resolved)
  expiresAt: Date,        // ุชุงุฑูุฎ ุงูุชูุงุก ุงูุชุญุฐูุฑ
}
```

### ุฅุฏุงุฑุฉ ุงูุชุญุฐูุฑุงุช

#### ุฅุตุฏุงุฑ ุชุญุฐูุฑ ูุฏูู

```http
POST /api/v1/warnings/admin
Content-Type: application/json

{
  "userId": "user_id",
  "warningType": "banned_word",
  "severity": "medium",
  "warningMessage": "ุฑุณุงูุฉ ุงูุชุญุฐูุฑ",
  "notes": "ููุงุญุธุงุช ุฅุถุงููุฉ"
}
```

#### ุนุฑุถ ุงูุชุญุฐูุฑุงุช

```http
GET /api/v1/warnings/admin                    // ุฌููุน ุงูุชุญุฐูุฑุงุช
GET /api/v1/warnings/admin/users/:userId      // ุชุญุฐูุฑุงุช ูุณุชุฎุฏู ูุนูู
GET /api/v1/warnings/admin/stats/summary      // ุฅุญุตุงุฆูุงุช ุงูุชุญุฐูุฑุงุช
GET /api/v1/warnings/my-warnings              // ุชุญุฐูุฑุงุชู (ูููุณุชุฎุฏู)
```

#### ุญู ุงูุชุญุฐูุฑุงุช

```http
PUT /api/v1/warnings/:id/resolve
Content-Type: application/json

{
  "resolutionNotes": "ุฃุณุจุงุจ ุงูุญู"
}
```

#### ุงุณุชุฆูุงู ุชุญุฐูุฑ (ูููุณุชุฎุฏู)

```http
PUT /api/v1/warnings/:id/appeal
Content-Type: application/json

{
  "appealReason": "ุณุจุจ ุงูุงุณุชุฆูุงู"
}
```

#### ุญู ุชุญุฐูุฑุงุช ุจุงูุฌููุฉ

```http
PUT /api/v1/warnings/admin/bulk-resolve
Content-Type: application/json

{
  "warningIds": ["id1", "id2"],
  "resolutionNotes": "ุญู ุฌูุงุนู"
}
```

---

## ๐ซ ูุธุงู ุงูุญุธุฑ

### ูููุฐุฌ ุงููุณุชุฎุฏู ุงููุญุฏุซ

```javascript
{
  isBlocked: Boolean,      // ุญุงูุฉ ุงูุญุธุฑ
  blockedUntil: Date,      // ุชุงุฑูุฎ ุงูุชูุงุก ุงูุญุธุฑ
  blockReason: String,     // ุณุจุจ ุงูุญุธุฑ
  blockedBy: ObjectId,     // ุงูุฅุฏุงุฑู ุงูุฐู ุญุธุฑ ุงููุณุชุฎุฏู
  warningCount: Number,    // ุนุฏุฏ ุงูุชุญุฐูุฑุงุช
  lastWarning: Date,       // ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฐูุฑ
}
```

### ุฅุฏุงุฑุฉ ุงูุญุธุฑ

#### ุญุธุฑ ูุณุชุฎุฏู ูุฏููุงู

```http
PUT /api/v1/moderation/users/:id/block
Content-Type: application/json

{
  "blockReason": "ุณุจุจ ุงูุญุธุฑ",
  "blockDurationHours": 24
}
```

#### ุฅูุบุงุก ุญุธุฑ ูุณุชุฎุฏู

```http
PUT /api/v1/moderation/users/:id/unblock
```

#### ุนุฑุถ ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู

```http
GET /api/v1/moderation/blocked
GET /api/v1/moderation/stats
```

#### ุฅุนุงุฏุฉ ุชุนููู ุชุญุฐูุฑุงุช ุงููุณุชุฎุฏู

```http
PUT /api/v1/moderation/users/:id/reset-warnings
```

#### ุฅูุบุงุก ุงูุญุธุฑ ุงูููุชูู ุงูุตูุงุญูุฉ

```http
POST /api/v1/moderation/unblock-expired
```

---

## ๐๏ธ ูุฑุงูุจุฉ ุงููุญุงุฏุซุงุช

### ุตูุงุญูุฉ ุงููุฑุงูุจุฉ

ุงูุฅุฏุงุฑููู ุงูุฐูู ูุฏููู `monitorChats: true` ูููููู ูุฑุงูุจุฉ ุงููุญุงุฏุซุงุช.

#### ุนุฑุถ ุฌููุน ุงููุญุงุฏุซุงุช

```http
GET /api/v1/admins/chats
```

#### ุนุฑุถ ูุญุงุฏุซุฉ ูุญุฏุฏุฉ

```http
GET /api/v1/admins/chats/:id
```

#### ุนุฑุถ ุฑุณุงุฆู ูุญุงุฏุซุฉ

```http
GET /api/v1/admins/chats/:id/messages
```

---

## ๐ ุงูุชุฏูู ุงูุชููุงุฆู ูููุดู ุนู ุงููุฎุงููุงุช

### 1. ุฅุฑุณุงู ุฑุณุงูุฉ

```
ุงููุณุชุฎุฏู โ ุฅุฑุณุงู ุฑุณุงูุฉ ูู ุงููุญุงุฏุซุฉ
```

### 2. ูุญุต ุงููุญุชูู

```
ุงููุธุงู โ ูุญุต ุงูุฑุณุงูุฉ ููุงุจู ุงููููุงุช ุงููุญุธูุฑุฉ
        โ ุฅุฐุง ููุฌุฏุช ูุฎุงููุฉ: ุฅูุดุงุก ุชุญุฐูุฑ
```

### 3. ุงูุชุญูู ูู ุงูุญุธุฑ

```
ุงููุธุงู โ ุญุณุงุจ ุชุญุฐูุฑุงุช ุงููุณุชุฎุฏู ูู 30 ููู
        โ ุฅุฐุง ุชุฌุงูุฒ ุงูุนุชุจุฉ: ุญุธุฑ ุชููุงุฆู
```

### 4. ุงูุฅุดุนุงุฑุงุช

```
ุงููุธุงู โ ุฅุฑุณุงู ุชุญุฐูุฑ ูููุณุชุฎุฏู
        โ ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ (ุงุฎุชูุงุฑู)
        โ ุญูุธ ุชูุงุตูู ุงููุฎุงููุฉ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ

### ุฅุญุตุงุฆูุงุช ุงููููุงุช ุงููุญุธูุฑุฉ

```http
GET /api/v1/banned-words/stats/summary
```

- ุนุฏุฏ ุงููููุงุช ุงููุดุทุฉ/ุบูุฑ ูุดุทุฉ
- ุชูุฒูุน ุญุณุจ ุงูุชุตููู ูุงูุดุฏุฉ
- ุฃูุซุฑ ุงููููุงุช ูุฎุงููุฉ

### ุฅุญุตุงุฆูุงุช ุงูุชุญุฐูุฑุงุช

```http
GET /api/v1/warnings/admin/stats/summary
```

- ุนุฏุฏ ุงูุชุญุฐูุฑุงุช ุงููุดุทุฉ/ุงููุญูููุฉ/ุงููุณุชุฃููุฉ
- ุชูุฒูุน ุญุณุจ ุงูููุน ูุงูุดุฏุฉ
- ุฃูุซุฑ ุงููุณุชุฎุฏููู ูุฎุงููุฉ

### ุฅุญุตุงุฆูุงุช ุงูุฅุฏุงุฑุฉ

```http
GET /api/v1/moderation/stats
```

- ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู ุญุงููุงู
- ุงููุญุธูุฑูู ูู ุขุฎุฑ 30 ููู
- ุงูุชุญุฐูุฑุงุช ูู ุขุฎุฑ 30 ููู
- ุงููุณุชุฎุฏููู ุฐูู ุงูุชุญุฐูุฑุงุช ุงููุชุนุฏุฏุฉ

---

## ๐ง ุงูุชูุงูู ูุน ุงููุธุงู

### ูุญุต ุงููุญุชูู ูู ChatService

```javascript
// ูู sendMessage function
if (content && messageType === "text") {
  // ูุญุต ุงููููุงุช ุงูููููุนุฉ
  const checkResult = await BannedWords.checkMessage(content);

  if (!checkResult.found) {
    // ุงูุฑุณุงูุฉ ุขููุฉ
    return res.json({ message: "Message sent successfully" });
  }

  // ุฅูุดุงุก ุชุญุฐูุฑ
  const warning = await UserWarnings.create({...});

  // ูุญุต ุงูุญุธุฑ ุงูุชููุงุฆู
  if (shouldBlock) {
    await autoBlockUser(userId, reason, duration);
  }

  // ุฅุฑุฌุงุน ุงูุชุญุฐูุฑ ูุน ุงูุฑุณุงูุฉ
  return res.json({
    warning: {...},
    bannedWord: bannedWord.word
  });
}
```

### ูุญุต ุงูุญุธุฑ ูู ChatService

```javascript
// ูู ุจุฏุงูุฉ sendMessage
const user = await User.findById(userId);
if (user.isBlocked && user.blockedUntil > new Date()) {
  return next(new ApiError(`You are blocked until ${user.blockedUntil}`, 403));
}
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ูุงูุชููุฆุฉ

### ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุฌุฏูุฏุฉ

```env
# ุฅุนุฏุงุฏุงุช ุงูุฅุฏุงุฑุฉ (ุงุฎุชูุงุฑูุฉ)
MODERATION_AUTO_BLOCK_ENABLED=true
MODERATION_WARNING_EXPIRY_DAYS=30
MODERATION_MAX_BULK_OPERATIONS=50
```

### ุงูููุงู ุงููุฌุฏููุฉ (Cron Jobs)

```javascript
// ุฅูุบุงุก ุงูุญุธุฑ ุงูููุชูู
const cron = require("node-cron");
cron.schedule("0 */6 * * *", async () => {
  // ูู 6 ุณุงุนุงุช
  await unblockExpiredBlocks();
});

// ุงูุชูุงุก ุตูุงุญูุฉ ุงูุชุญุฐูุฑุงุช ุงููุฏููุฉ
cron.schedule("0 0 * * *", async () => {
  // ููููุงู
  await expireOldWarnings();
});
```

---

## ๐ ุงูุฃูุงู ูุงูุญูุงูุฉ

### ุญูุงูุฉ ุงูู Routes

- ุฌููุน routes ุงูุฅุฏุงุฑูุฉ ูุญููุฉ ุจู `authService.protect`
- ูุญุต ุตูุงุญูุงุช ูุญุฏุฏุฉ ููู ุนูููุฉ
- Validation ุดุงูู ูููุฏุฎูุงุช
- Rate limiting ููุนูููุงุช ุงูุญุณุงุณุฉ

### ุญูุงูุฉ ุงูุจูุงูุงุช

- ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- Audit logs ูุฌููุน ุงูุนูููุงุช
- Backup ุฏูุฑู ููุจูุงูุงุช
- Soft delete ูููููุงุช ุงููุญุธูุฑุฉ

---

## ๐ ุงูุงุณุชุฎุฏุงู ูุงูุชุทุจูู

### ุฅุนุฏุงุฏ ุงููุธุงู ููุฅูุชุงุฌ

1. ุฅุถุงูุฉ ูููุงุช ูุญุธูุฑุฉ ุฃุณุงุณูุฉ
2. ุชููุฆุฉ ุตูุงุญูุงุช ุงูุฅุฏุงุฑููู
3. ุฅุนุฏุงุฏ ุงูููุงู ุงููุฌุฏููุฉ
4. ุชุฏุฑูุจ ุงูุฅุฏุงุฑููู ุนูู ุงููุธุงู

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก

- ุชุชุจุน ุงุณุชุฎุฏุงู ุงููุธุงู
- ูุฑุงูุจุฉ ูุนุฏูุงุช ุงููุดู ุนู ุงููุฎุงููุงุช
- ุชุญููู ูุนุงููุฉ ุงูุชุญุฐูุฑุงุช
- ุชูููู ุฏูุฉ ุงููุธุงู

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููููุงุช ุงููุญุธูุฑุฉ**: ุชุฏุนู ุงููุชุบูุฑุงุช ูุงูุฅููุงุกุงุช ุงูุจุฏููุฉ
2. **ุงูุญุธุฑ ุงูุชููุงุฆู**: ูุงุจู ููุชุฎุตูุต ุญุณุจ ุนุฏุฏ ุงูุชุญุฐูุฑุงุช
3. **ุงูุงุณุชุฆูุงู**: ูููู ูููุณุชุฎุฏููู ุงุณุชุฆูุงู ุงูุชุญุฐูุฑุงุช
4. **ุงููุฑุงูุจุฉ**: ุงูุฅุฏุงุฑููู ูููููู ูุฑุงูุจุฉ ุฌููุน ุงููุญุงุฏุซุงุช
5. **ุงูุฅุญุตุงุฆูุงุช**: ุชูุงุฑูุฑ ุดุงููุฉ ููุชุงุจุนุฉ ุงูุฃุฏุงุก

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุงูุชูุณุน! ๐ฏโจ
